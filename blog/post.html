<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Blogginnlegg – Attolloo Group</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style.css?v=8">
</head>
<body data-page="blog-post">

<header class="site-header">
  <div class="container">
    <a class="site-logo" href="../index.html"><img src="../aab-logo.png" alt="Attolloo logo"></a>
    <span class="site-brand-text">Attolloo Group</span>
    <nav class="main-nav">
      <ul>
        <li><a href="../index.html">Forside</a></li>
        <li><a href="../about.html">Om oss</a></li>
        <li><a href="../services.html">Tjenester</a></li>
        <li><a href="index.html">Blogg</a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="page-top-space"></div>

<main class="container">
  <article class="post">
    <h1 id="post-title">Laster …</h1>
    <p id="post-date"></p>
    <img id="post-cover" class="small-cover" src="" alt="" style="display:none">
    <div id="post-content"></div>
  </article>
  <p><a href="index.html">← Tilbake til bloggen</a></p>
</main>

<footer class="container">
  <p>&copy; <span id="year"></span> Attolloogroup.</p>
</footer>

<script>
  // ©-år
  document.getElementById('year').textContent = new Date().getFullYear();

  // Enkel formattering av ren tekst -> <p>
  function simpleTextToHTML(txt){
    if(!txt) return '';
    return String(txt).split(/\n{2,}/).map(p=>`<p>${p.replace(/\n/g,'<br>')}</p>`).join('');
  }

  (async function loadPost(){
    const params   = new URLSearchParams(location.search);
    const slug     = params.get('p');

    const titleEl  = document.getElementById('post-title');
    const dateEl   = document.getElementById('post-date');
    const coverEl  = document.getElementById('post-cover');
    const bodyEl   = document.getElementById('post-content');

    // wrapper til bildet (kan hete post-cover-wrap; hvis ikke finnes, bruk parent)
    const coverWrap = document.getElementById('post-cover-wrap') || (coverEl ? coverEl.parentElement : null);

    if(!slug){ titleEl.textContent = 'Fant ikke innlegget'; return; }

    try {
      // 1) Finn metadata for posten
      const res   = await fetch('posts.json?v='+Date.now(), { cache: 'no-store' });
      const posts = await res.json();
      const post  = Array.isArray(posts) ? posts.find(p => p.slug === slug) : null;

      if(!post){ titleEl.textContent = 'Innlegget finnes ikke'; return; }

      // Tittel & dato
      titleEl.textContent = post.title || 'Uten tittel';
      if (post.date){
        const d = new Date(post.date);
        dateEl.textContent = isNaN(d) ? post.date
          : d.toLocaleDateString('no-NO', { weekday:'short', year:'numeric', month:'short', day:'2-digit' });
      } else {
        dateEl.textContent = '';
      }

      // 2) Vis cover-bilde hvis tilgjengelig
      const cover = post.cover || post.image || post.hero_image || null;
      if (cover && coverEl){
        coverEl.src = cover;
        coverEl.alt = post.title ? `Cover: ${post.title}` : '';
        if (coverWrap) coverWrap.style.display = 'block';
      } else if (coverWrap){ 
        coverWrap.style.display = 'none';
      }

      // 3) Hent HTML-innhold for posten (fallback: excerpt)
      // Forventer fil sti: /blog/posts/<slug>.html
      const htmlURL = `posts/${slug}.html?v=${Date.now()}`;
      let html = '';

      try {
        const htmlRes = await fetch(htmlURL, { cache: 'no-store' });
        if (htmlRes.ok) {
          html = await htmlRes.text();
        }
      } catch(e) {
        // ignorer, fall tilbake under
      }

      if (html && /<\s*[a-z][\s\S]*>/i.test(html)){
        bodyEl.innerHTML = html;
      } else if (post.excerpt){
        bodyEl.innerHTML = simpleTextToHTML(post.excerpt);
      } else {
        bodyEl.innerHTML = '<p>(Ingen innhold)</p>';
      }

    } catch (e) {
      console.error(e);
      document.getElementById('post-title').textContent = 'Feil: kunne ikke laste blogginnlegg.';
    }
  })();
</script>


</body>
</html>
