<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blogger – Attolloo Group</title>
  <link rel="stylesheet" href="../style.css" />
</head>
<body data-page="blog-post">

  <!-- HEADER (samme som de andre sidene) -->
  <header class="site-header">
    <div class="container">
      <a class="site-logo" href="../index.html" aria-label="Til forsiden">
        <img src="../aab-logo.png" alt="Attolloo logo" />
      </a>
      <span class="site-brand-text">Attolloo Group</span>
      <nav class="main-nav" aria-label="Hovedmeny">
        <ul>
          <li><a href="../index.html">Forside</a></li>
          <li><a href="../about.html">Om oss</a></li>
          <li><a href="../services.html">Tjenester</a></li>
          <li><a href="./index.html" aria-current="page">Blogg</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="page-top-space"></div>

  <!-- INNHOLD -->
  <main class="container">
    <section class="section">
      <h1 id="post-title" class="page-title">Laster …</h1>
      <p id="post-date" class="muted"></p>
      <p id="post-excerpt"></p>

      <img id="post-cover" alt="" style="display:none;" />

      <div id="post-content" class="card_text">(Ingen innhold)</div>

      <p style="margin-top:1.25rem">
        <a class="btn-link" href="./index.html">← Tilbake til bloggen</a>
      </p>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>© <span id="year"></span> Attolloogroup.</p>
      <p>Org.nr: 936 616 758</p>
      <p>Kontakt: <a href="mailto:post@attolloogroup.com">post@attolloogroup.com</a></p>
    </div>
  </footer>

  <script>
    // årstall i footer
    document.getElementById('year').textContent = new Date().getFullYear();

    // --- Mini markdown -> HTML (enkel) ---
    function mdToHtml(txt) {
      if (!txt) return '';
      // overskrifter, fet/kursiv, lenker, avsnitt/linjer
      return txt
        .replace(/^### (.*)$/gm, '<h3>$1</h3>')
        .replace(/^## (.*)$/gm, '<h2>$1</h2>')
        .replace(/^# (.*)$/gm, '<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2">$1</a>')
        .split(/\n{2,}/).map(p => `<p>${p.replace(/\n/g,'<br>')}</p>`).join('');
    }

    // Slug fra URL (?p=)
    const slug = new URLSearchParams(location.search).get('p');

    (async function loadPost(){
      const titleEl   = document.getElementById('post-title');
      const dateEl    = document.getElementById('post-date');
      const excerptEl = document.getElementById('post-excerpt');
      const coverEl   = document.getElementById('post-cover');
      const bodyEl    = document.getElementById('post-content');

      if (!slug) { titleEl.textContent = 'Fant ikke innlegget'; return; }

      try {
        // 1) Finn metadata fra posts.json
        const resMeta = await fetch('posts.json?v=' + Date.now(), { cache: 'no-store' });
        const posts   = await resMeta.json();
        const meta    = Array.isArray(posts) ? posts.find(p => p.slug === slug) : null;

        // Sett tittel/dato/ingress/cover dersom de finnes
        if (meta) {
          titleEl.textContent = meta.title || 'Uten tittel';
          if (meta.date) {
            const d = new Date(meta.date);
            dateEl.textContent = isNaN(d) ? meta.date : d.toLocaleDateString('no-NO', { weekday:'short', day:'2-digit', month:'short', year:'numeric' });
          }
          excerptEl.textContent = meta.excerpt || '';
          if (meta.cover) {
            coverEl.src = meta.cover;
            coverEl.style.display = 'block';
            coverEl.alt = meta.title ? ('Cover: ' + meta.title) : '';
          }
        } else {
          titleEl.textContent = 'Innlegget finnes ikke';
        }

        // 2) Hent selve artikkelen (markdown) fra /blog/posts/<slug>.md
        const resMd = await fetch('posts/' + slug + '.md?v=' + Date.now(), { cache: 'no-store' });
        let md = await resMd.text();

        // Fjern YAML front matter om det finnes
        if (md.startsWith('---')) {
          const end = md.indexOf('\n---', 3);
          if (end !== -1) md = md.slice(end + 4);
        }
        // Rydd litt whitespace
        md = md.trim();

        // Render markdown -> HTML (enkel)
        bodyEl.innerHTML = md ? mdToHtml(md) : '<p>(Ingen innhold)</p>';

      } catch (e) {
        console.error(e);
        titleEl.textContent = 'Feil: kunne ikke laste blogginlegg.';
        bodyEl.innerHTML = '';
      }
    })();
  </script>
</body>
</html>
