<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Blogginnlegg – Attolloo Group</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style.css?v=8">
</head>
<body data-page="blog-post">

<header class="site-header">
  <div class="container">
    <a class="site-logo" href="../index.html"><img src="../aab-logo.png" alt="Attolloo logo"></a>
    <span class="site-brand-text">Attolloo Group</span>
    <nav class="main-nav">
      <ul>
        <li><a href="../index.html">Forside</a></li>
        <li><a href="../about.html">Om oss</a></li>
        <li><a href="../services.html">Tjenester</a></li>
        <li><a href="index.html">Blogg</a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="page-top-space"></div>

<main class="container">
  <article class="post">
    <h1 id="post-title">Laster …</h1>
    <p id="post-date"></p>
    <img id="post-cover" class="small-cover" src="" alt="" style="display:none">
    <div id="post-content"></div>
  </article>
  <p><a href="index.html">← Tilbake til bloggen</a></p>
</main>

<footer class="container">
  <p>&copy; <span id="year"></span> Attolloogroup.</p>
</footer>

<script>
// © årstall i footer
document.getElementById('year').textContent = new Date().getFullYear();

// Enkel markdown-til-HTML
function mdToHTML(md) {
  if (!md) return '';
  let html = md
    .replace(/^###### (.*)$/gm,'<h6>$1</h6>')
    .replace(/^##### (.*)$/gm,'<h5>$1</h5>')
    .replace(/^#### (.*)$/gm,'<h4>$1</h4>')
    .replace(/^### (.*)$/gm,'<h3>$1</h3>')
    .replace(/^## (.*)$/gm,'<h2>$1</h2>')
    .replace(/^# (.*)$/gm,'<h1>$1</h1>')
    .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
    .replace(/\*(.+?)\*/g,'<em>$1</em>')
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2">$1</a>');
  return html.split(/\n{2,}/).map(p=>`<p>${p}</p>`).join('');
}

(async function loadPost(){
  const slug = new URLSearchParams(location.search).get('p');

  const titleEl = document.getElementById('post-title');
  const dateEl  = document.getElementById('post-date');
  const coverEl = document.getElementById('post-cover');
  const coverWrap = document.getElementById('post-cover-wrap');
  const bodyEl  = document.getElementById('post-content');

  if (!slug){ titleEl.textContent = 'Fant ikke innlegget'; return; }

  try {
    // Metadata fra posts.json
    const metaRes = await fetch('posts.json?v='+Date.now(), { cache:'no-store' });
    const posts   = await metaRes.json();
    const post    = posts.find(p => p.slug === slug);
    if (!post){ titleEl.textContent = 'Innlegget finnes ikke'; return; }

    // Sett tittel og dato
    titleEl.textContent = post.title || 'Uten tittel';
    if (post.date){
      const d = new Date(post.date);
      dateEl.textContent = isNaN(d)
        ? post.date
        : d.toLocaleDateString('no-NO', { weekday:'long', year:'numeric', month:'long', day:'2-digit' });
    }

    // Cover-bilde
    if (post.cover && coverEl){
      coverEl.src = post.cover;
      coverEl.alt = post.title || '';
      coverWrap.style.display = 'block';
    } else {
      coverWrap.style.display = 'none';
    }

    // Hent selve innholdet (Markdown eller HTML)
    let html = '';
    const mdPath = `posts/${slug}.md`;
    const htmlPath = `posts/${slug}.html`;

    try {
      const mdRes = await fetch(mdPath+'?v='+Date.now(), { cache:'no-store' });
      if (mdRes.ok){
        const raw = await mdRes.text();
        html = mdToHTML(raw);
      }
    } catch(e){}

    if (!html){
      try {
        const hRes = await fetch(htmlPath+'?v='+Date.now(), { cache:'no-store' });
        if (hRes.ok){
          html = await hRes.text();
        }
      } catch(e){}
    }

    bodyEl.innerHTML = html || post.excerpt || '<p>(Ingen innhold)</p>';

  } catch(e){
    console.error(e);
    titleEl.textContent = 'Feil: kunne ikke laste blogginnlegg.';
  }
})();
</script>



</body>
</html>
